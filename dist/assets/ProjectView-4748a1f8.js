import{i as E,j as O,d as q,u as G,r as j,c as w,a as l,b as e,t as d,n as x,e as S,f as p,w as f,v as g,F as U,g as A,h as H,k as J,o as a,l as T,m as K,_ as Q}from"./index-419b7360.js";import{u as W}from"./projects-dfbcff17.js";import{u as X}from"./tasks-5e9573c6.js";const Y=E("access",{state:()=>({accesses:[...O]}),getters:{getAccessesByProject:c=>v=>c.accesses.filter(r=>r.projectId===v)},actions:{addAccess(c){this.accesses.push(c)},updateAccess(c){const v=this.accesses.findIndex(r=>r.id===c.id);v!==-1&&(this.accesses[v]=c)},deleteAccess(c){this.accesses=this.accesses.filter(v=>v.id!==c)}}}),Z={key:0,class:"project-view"},ee={class:"project-header"},se={class:"project-description"},te={key:0,class:"action-buttons"},oe={class:"project-content"},le={class:"tasks-section"},ae={class:"section-header"},ie={key:0,class:"add-task-form"},ne={class:"form-group"},de={class:"form-group"},re={class:"form-group"},ue={class:"form-group"},ce={class:"assignees-selection"},ve=["onClick"],pe={class:"tasks-list"},me={key:0,class:"empty-message"},fe=["onClick"],ge={class:"task-title"},ke={class:"task-details"},_e={key:0,class:"accesses-section"},ye={class:"section-header"},je={key:0,class:"add-access-form"},we={class:"form-group"},he={class:"form-group"},be={class:"form-group"},xe={class:"form-group"},Se={class:"accesses-list"},Ue={key:0,class:"empty-message"},Ae={class:"access-url"},Ce={class:"access-credentials"},Ve={key:0,class:"access-comment"},Pe={key:1,class:"loading"},Te=q({__name:"ProjectView",setup(c){const v=H(),r=J(),h=W(),b=X(),C=Y(),k=G(),_=j(!1),y=j(!1),m=j([]),n=j({title:"",description:"",deadline:""}),o=j({url:"",login:"",password:"",comment:""}),u=w(()=>h.projects.find(i=>i.id===r.params.id)),V=w(()=>{var i;return((i=k.currentUser)==null?void 0:i.role)==="employee"?b.getTasksByProject(r.params.id).filter(s=>{var t;return s.assignees.includes(((t=k.currentUser)==null?void 0:t.id)||"")}):b.getTasksByProject(r.params.id)}),P=w(()=>C.getAccessesByProject(r.params.id)),B=w(()=>K.filter(i=>i.role==="employee")),D={new:"Новая задача",in_progress:"В работе",done:"Готова",backlog:"Беклог"};function I(i){return new Date(i).toLocaleDateString("ru-RU")}function L(i){v.push(`/task/${i}`)}function R(){u.value&&h.archiveProject(u.value.id)}function $(){u.value&&h.activateProject(u.value.id)}function F(i){const s=m.value.indexOf(i);s===-1?m.value.length<3&&m.value.push(i):m.value.splice(s,1)}function M(){var i;!n.value.title.trim()||!n.value.deadline||(b.addTask({id:Date.now().toString(),title:n.value.title,description:n.value.description,deadline:n.value.deadline,projectId:r.params.id,creatorId:((i=k.currentUser)==null?void 0:i.id)||"",assignees:m.value,status:"new",comments:[]}),n.value.title="",n.value.description="",n.value.deadline="",m.value=[],_.value=!1)}function N(){!o.value.url.trim()||!o.value.login.trim()||(C.addAccess({id:Date.now().toString(),projectId:r.params.id,url:o.value.url,login:o.value.login,password:o.value.password,comment:o.value.comment}),o.value.url="",o.value.login="",o.value.password="",o.value.comment="",y.value=!1)}return(i,s)=>u.value?(a(),l("div",Z,[e("div",ee,[e("h2",null,d(u.value.title),1),e("div",{class:x(["status-badge",u.value.status])},d(u.value.status==="active"?"Активный":"Архив"),3)]),e("p",se,d(u.value.description),1),S(k).isManager?(a(),l("div",te,[u.value.status==="active"?(a(),l("button",{key:0,onClick:R}," Архивировать ")):(a(),l("button",{key:1,onClick:$}," Активировать "))])):p("",!0),e("div",oe,[e("div",le,[e("div",ae,[s[9]||(s[9]=e("h3",null,"Задачи",-1)),S(k).isManager?(a(),l("button",{key:0,onClick:s[0]||(s[0]=t=>_.value=!_.value)},d(_.value?"Отмена":"Добавить задачу"),1)):p("",!0)]),_.value?(a(),l("div",ie,[e("div",ne,[s[10]||(s[10]=e("label",{for:"task-title"},"Название",-1)),f(e("input",{type:"text",id:"task-title","onUpdate:modelValue":s[1]||(s[1]=t=>n.value.title=t),placeholder:"Название задачи"},null,512),[[g,n.value.title]])]),e("div",de,[s[11]||(s[11]=e("label",{for:"task-description"},"Описание",-1)),f(e("textarea",{id:"task-description","onUpdate:modelValue":s[2]||(s[2]=t=>n.value.description=t),placeholder:"Описание задачи"},null,512),[[g,n.value.description]])]),e("div",re,[s[12]||(s[12]=e("label",{for:"task-deadline"},"Дедлайн",-1)),f(e("input",{type:"date",id:"task-deadline","onUpdate:modelValue":s[3]||(s[3]=t=>n.value.deadline=t)},null,512),[[g,n.value.deadline]])]),e("div",ue,[s[13]||(s[13]=e("label",null,"Исполнители",-1)),e("div",ce,[(a(!0),l(U,null,A(B.value,t=>(a(),l("div",{key:t.id,class:x(["assignee-option",{selected:m.value.includes(t.id)}]),onClick:z=>F(t.id)},d(t.name),11,ve))),128))])]),e("button",{onClick:M},"Создать задачу")])):p("",!0),e("div",pe,[V.value.length===0?(a(),l("div",me," Нет задач ")):p("",!0),(a(!0),l(U,null,A(V.value,t=>(a(),l("div",{key:t.id,class:"task-card",onClick:z=>L(t.id)},[e("div",{class:x(["task-status",t.status])},d(D[t.status]),3),e("div",ge,d(t.title),1),e("div",ke,[e("div",null,"Дедлайн: "+d(I(t.deadline)),1)])],8,fe))),128))])]),S(k).isManager?(a(),l("div",_e,[e("div",ye,[s[14]||(s[14]=e("h3",null,"Доступы",-1)),e("button",{onClick:s[4]||(s[4]=t=>y.value=!y.value)},d(y.value?"Отмена":"Добавить доступ"),1)]),y.value?(a(),l("div",je,[e("div",we,[s[15]||(s[15]=e("label",{for:"url"},"URL",-1)),f(e("input",{type:"text",id:"url","onUpdate:modelValue":s[5]||(s[5]=t=>o.value.url=t),placeholder:"URL сервиса"},null,512),[[g,o.value.url]])]),e("div",he,[s[16]||(s[16]=e("label",{for:"login"},"Логин",-1)),f(e("input",{type:"text",id:"login","onUpdate:modelValue":s[6]||(s[6]=t=>o.value.login=t),placeholder:"Логин"},null,512),[[g,o.value.login]])]),e("div",be,[s[17]||(s[17]=e("label",{for:"password"},"Пароль",-1)),f(e("input",{type:"text",id:"password","onUpdate:modelValue":s[7]||(s[7]=t=>o.value.password=t),placeholder:"Пароль"},null,512),[[g,o.value.password]])]),e("div",xe,[s[18]||(s[18]=e("label",{for:"comment"},"Комментарий",-1)),f(e("textarea",{id:"comment","onUpdate:modelValue":s[8]||(s[8]=t=>o.value.comment=t),placeholder:"Комментарий"},null,512),[[g,o.value.comment]])]),e("button",{onClick:N},"Добавить доступ")])):p("",!0),e("div",Se,[P.value.length===0?(a(),l("div",Ue," Нет доступов ")):p("",!0),(a(!0),l(U,null,A(P.value,t=>(a(),l("div",{key:t.id,class:"access-card"},[e("div",Ae,d(t.url),1),e("div",Ce,[e("div",null,[s[19]||(s[19]=e("strong",null,"Логин:",-1)),T(" "+d(t.login),1)]),e("div",null,[s[20]||(s[20]=e("strong",null,"Пароль:",-1)),T(" "+d(t.password),1)])]),t.comment?(a(),l("div",Ve,d(t.comment),1)):p("",!0)]))),128))])])):p("",!0)])])):(a(),l("div",Pe," Загрузка проекта... "))}});const Le=Q(Te,[["__scopeId","data-v-7311d2dd"]]);export{Le as default};
