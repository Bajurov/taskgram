import{d as M,u as R,r as U,c as _,a as o,b as t,n as p,t as i,l as f,F as b,g as S,f as c,w as $,v as N,p as B,h as A,k as E,m as F,o as r,e as K,_ as z}from"./index-419b7360.js";import{u as P}from"./tasks-5e9573c6.js";import{u as q}from"./projects-dfbcff17.js";const G={key:0,class:"task-container"},H={class:"task-header"},J={class:"task-meta"},O={class:"meta-item"},Q={class:"meta-item"},W={class:"meta-item"},X={class:"meta-item"},Y={key:0},Z={key:1},ee={class:"task-description"},te={key:0,class:"task-actions"},se={key:0,class:"status-actions"},ae={class:"status-buttons"},ne=["disabled","onClick"],oe={key:1,class:"delete-action"},re={key:0,class:"confirm-delete"},ie={class:"confirm-buttons"},ue={class:"task-chat"},le={class:"chat-messages"},de={key:0,class:"empty-chat"},ce={class:"message-header"},ve={class:"message-time"},_e={class:"message-text"},me={class:"chat-input"},ke={key:1,class:"loading"},pe=M({__name:"TaskView",setup(fe){const w=A(),T=E(),v=P(),u=R(),x=q(),d=U(""),m=U(!1),s=_(()=>v.tasks.find(n=>n.id===T.params.id)),D=_(()=>{if(!s.value)return"";const n=x.projects.find(e=>{var a;return e.id===((a=s.value)==null?void 0:a.projectId)});return n?n.title:""}),g=_(()=>{if(!s.value||!u.currentUser)return!1;const n=s.value.creatorId===u.currentUser.id,e=u.isManager;return n||e}),h=_(()=>{if(!s.value||!u.currentUser)return!1;const n=s.value.assignees.includes(u.currentUser.id),e=s.value.creatorId===u.currentUser.id,a=u.isManager;return n||e||a}),y={new:"Новая задача",in_progress:"В работе",done:"Готова",backlog:"Беклог"};function k(n){const e=F.find(a=>a.id===n);return e?e.name:"Неизвестный пользователь"}function I(n){return new Date(n).toLocaleDateString("ru-RU")}function j(n){try{const e=new Date(n);return`${e.toLocaleDateString("ru-RU")} ${e.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`}catch{return n}}function V(n){s.value&&v.changeTaskStatus(s.value.id,n)}function C(){!d.value.trim()||!s.value||!u.currentUser||(v.addComment(s.value.id,{taskId:s.value.id,authorId:u.currentUser.id,text:d.value}),d.value="")}function L(){s.value&&(v.deleteTask(s.value.id),w.push("/"))}return(n,e)=>s.value?(r(),o("div",G,[t("div",H,[t("div",{class:p(["task-status",s.value.status])},i(y[s.value.status]),3),t("h2",null,i(s.value.title),1)]),t("div",J,[t("div",O,[e[3]||(e[3]=t("strong",null,"Проект:",-1)),f(" "+i(D.value),1)]),t("div",Q,[e[4]||(e[4]=t("strong",null,"Дедлайн:",-1)),f(" "+i(I(s.value.deadline)),1)]),t("div",W,[e[5]||(e[5]=t("strong",null,"Постановщик:",-1)),f(" "+i(k(s.value.creatorId)),1)]),t("div",X,[e[6]||(e[6]=t("strong",null,"Исполнители:",-1)),s.value.assignees.length?(r(),o("span",Y,i(s.value.assignees.map(a=>k(a)).join(", ")),1)):(r(),o("span",Z,"Не назначены"))])]),t("div",ee,[e[7]||(e[7]=t("h3",null,"Описание",-1)),t("p",null,i(s.value.description),1)]),g.value||h.value?(r(),o("div",te,[h.value?(r(),o("div",se,[e[8]||(e[8]=t("h3",null,"Изменить статус",-1)),t("div",ae,[(r(),o(b,null,S(y,(a,l)=>t("button",{key:l,disabled:s.value.status===l,class:p([l,{active:s.value.status===l}]),onClick:ge=>V(l)},i(a),11,ne)),64))])])):c("",!0),g.value?(r(),o("div",oe,[t("button",{class:"delete-button",onClick:e[0]||(e[0]=a=>m.value=!0)}," Удалить задачу "),m.value?(r(),o("div",re,[e[9]||(e[9]=t("p",null,"Вы уверены, что хотите удалить задачу?",-1)),t("div",ie,[t("button",{onClick:L},"Да, удалить"),t("button",{onClick:e[1]||(e[1]=a=>m.value=!1)},"Отмена")])])):c("",!0)])):c("",!0)])):c("",!0),t("div",ue,[e[10]||(e[10]=t("h3",null,"Обсуждение",-1)),t("div",le,[s.value.comments.length?c("",!0):(r(),o("div",de," Нет сообщений. Будьте первым! ")),(r(!0),o(b,null,S(s.value.comments,a=>{var l;return r(),o("div",{key:a.id,class:p(["chat-message",{"own-message":a.authorId===((l=K(u).currentUser)==null?void 0:l.id)}])},[t("div",ce,[t("strong",null,i(k(a.authorId)),1),t("span",ve,i(j(a.createdAt)),1)]),t("div",_e,i(a.text),1)],2)}),128))]),t("div",me,[$(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),placeholder:"Напишите сообщение...",onKeyup:B(C,["enter"])},null,544),[[N,d.value]]),t("button",{onClick:C},"Отправить")])])])):(r(),o("div",ke," Загрузка задачи... "))}});const Ue=z(pe,[["__scopeId","data-v-faa35ee5"]]);export{Ue as default};
